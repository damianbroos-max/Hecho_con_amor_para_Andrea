<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Para Andrea ‚ù§Ô∏è</title>
    <style>
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; touch-action: none;
            background: radial-gradient(circle at center, #1a0b2e 0%, #050510 100%);
            font-family: 'Georgia', serif;
        }
        canvas { display: block; position: fixed; top: 0; left: 0; z-index: 5; }
        
        #dedicatoria {
            position: absolute; top: 20px; width: 100%; text-align: center;
            color: #d8b4fe; font-size: clamp(1.1rem, 5vw, 1.8rem);
            font-style: italic; text-shadow: 0 0 10px rgba(168, 85, 247, 0.9);
            z-index: 100; pointer-events: none;
        }

        #instrucciones {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 80%; text-align: center; color: #a78bfa;
            font-size: 1.2rem; pointer-events: none; z-index: 50; 
            transition: opacity 0.8s ease; animation: pulse 2.5s infinite;
        }

        @keyframes pulse { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
    </style>
</head>
<body>

    <div id="dedicatoria">Feliz 17 de enero mi amorcito Andrea ‚ù§Ô∏è</div>
    <div id="instrucciones">Sube el volumen y toca la pantalla... üéµ</div>
    
    <audio controls>
        <source src="Hecha_pa_mi-Boza.mp3" type="audio/mpeg">
    </audio>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const audio = document.getElementById('musica');
        const instr = document.getElementById('instrucciones');
        
        let flowers = [];
        let stars = [];
        let petals = [];
        let time = 0;
        let musicStarted = false;

        const originalPhrases = [
            "Eres mi pensamiento favorito", "Te amo infinito",
            "Contigo el mundo es perfecto", "Cada p√©talo es un beso",
            "Para mi Andrea hermosa", "Hecha pa' mi...",
            "T√∫ eres mi magia", "17 de enero ‚ù§Ô∏è"
        ];
        let availablePhrases = [];

        function getNextPhrase() {
            if (availablePhrases.length === 0) {
                availablePhrases = [...originalPhrases].sort(() => Math.random() - 0.5);
            }
            return availablePhrases.pop();
        }

        function init() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            stars = [];
            for(let i = 0; i < 80; i++) {
                stars.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, s: Math.random() * 2 });
            }
            petals = [];
            for(let i = 0; i < 20; i++) { petals.push(new Petal()); }
        }

        class Petal {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * canvas.width;
                this.y = -20;
                this.size = 4 + Math.random() * 5;
                this.speedY = 0.6 + Math.random() * 1;
                this.speedX = (Math.random() - 0.5) * 1.5;
                this.angle = Math.random() * Math.PI * 2;
                this.spin = (Math.random() - 0.5) * 0.04;
            }
            update() {
                this.y += this.speedY;
                this.x += this.speedX + Math.sin(time * 0.5) * 0.5;
                this.angle += this.spin;
                if (this.y > canvas.height) this.reset();
            }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle);
                ctx.fillStyle = "rgba(168, 85, 247, 0.5)";
                ctx.beginPath(); ctx.ellipse(0, 0, this.size, this.size/1.8, 0, 0, Math.PI * 2);
                ctx.fill(); ctx.restore();
            }
        }

        class Flower {
            constructor(x, y) {
                this.x = x; this.y = y;
                this.growth = 0; this.opacity = 0;
                this.phrase = getNextPhrase();
                this.offset = Math.random() * 10;
            }
            draw() {
                if(this.growth < 1) this.growth += 0.03;
                if(this.opacity < 1) this.opacity += 0.04;
                const sway = Math.sin(time + this.offset) * 12;

                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.scale(this.growth, this.growth);
                ctx.globalAlpha = this.opacity;

                ctx.strokeStyle = '#2d5a27'; ctx.lineWidth = 4;
                ctx.beginPath(); ctx.moveTo(0, 140); ctx.quadraticCurveTo(sway, 70, sway, 0); ctx.stroke();

                ctx.translate(sway, 0);
                
                const drawP = (ox, oy, w, h, ang, c1, c2) => {
                    ctx.save(); ctx.translate(ox, oy); ctx.rotate(ang);
                    const g = ctx.createRadialGradient(0,0,0,0,0,h);
                    g.addColorStop(0, c1); g.addColorStop(1, c2);
                    ctx.fillStyle = g; ctx.beginPath(); ctx.ellipse(0,0,w,h,0,0,Math.PI * 2); ctx.fill();
                    ctx.restore();
                };

                drawP(-12, -10, 14, 32, -0.2, '#9333ea', '#4c1d95');
                drawP(12, -10, 14, 32, 0.2, '#9333ea', '#4c1d95');
                drawP(0, 0, 18, 38, 0, '#c084fc', '#6b21a8');

                ctx.shadowBlur = 10; ctx.shadowColor = "white";
                ctx.fillStyle = "white"; ctx.font = "italic 18px Georgia";
                ctx.textAlign = "center"; ctx.fillText(this.phrase, 0, -55);
                ctx.restore();
            }
        }

        function handleInteraction(e) {
            if (!musicStarted) {
                audio.play().catch(() => {});
                musicStarted = true;
                instr.style.opacity = '0';
                setTimeout(() => { instr.style.display = 'none'; }, 800);
            }

            let clientX, clientY;
            if (e.touches && e.touches.length > 0) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            if (clientX !== undefined && clientY !== undefined) {
                // --- VERIFICACI√ìN DE SOBREPOSICI√ìN ---
                // Si el nuevo toque est√° a menos de 80px de otra flor, no la crea
                const tooClose = flowers.some(f => {
                    const dx = f.x - clientX;
                    const dy = f.y - clientY;
                    return Math.sqrt(dx*dx + dy*dy) < 80; 
                });

                if (!tooClose) {
                    flowers.push(new Flower(clientX, clientY - 50));
                    // L√çMITE DE 5 FLORES
                    if(flowers.length > 5) flowers.shift();
                }
            }
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            time += 0.015;

            ctx.fillStyle = "white";
            stars.forEach(s => {
                ctx.globalAlpha = 0.2 + Math.abs(Math.sin(time + s.x)) * 0.8;
                ctx.beginPath(); ctx.arc(s.x, s.y, s.s, 0, Math.PI*2); ctx.fill();
            });

            ctx.globalAlpha = 1;
            petals.forEach(p => { p.update(); p.draw(); });
            flowers.forEach(f => f.draw());

            requestAnimationFrame(animate);
        }

        window.addEventListener('mousedown', handleInteraction);
        window.addEventListener('touchstart', (e) => {
            handleInteraction(e);
        }, { passive: true });
        
        window.addEventListener('resize', init);
        
        init();
        animate();
    </script>
</body>
</html>




